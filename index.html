<!DOCTYPE html>
<html>
	<head>
		<title>Wrist Weather Settings</title>
		
		<style>
			body {
				text-align: center;
				background: #faf8ef;
			}
			
			input {
				width: 20px;
				height: 20px;
			}
		</style>
	</head>
	<body>
		<h1>Settings</h1>
		<div id="content" align="left">
			<h3>Content of Daily Summary</h3>
			<form align="left">
				<input type="checkbox" class="dailySummaryOptionElements" name="temp" value="temperature">
				<label for="temp">Temperature</label></br>
				<input type="checkbox" class="dailySummaryOptionElements" name="precip" value="precipitation">
				<label for="precip">Precipitation</label></br>
				<input type="checkbox" class="dailySummaryOptionElements" name="light" value="light">
				<label for="light">Light</label></br>
				<input type="checkbox" class="dailySummaryOptionElements" name="misc" value="misc">
				<label for="misc">Miscellaneous</label></br>
			</form>
		</div>
		
		<p>
			<button id="save_button">Save</button>
			<button id="reset_button">Reset</button>
		</p>
		
		<script>
			var dailySummaryOptionElements = document.getElementsByClassName("dailySummaryOptionElements");
			var savedSettings = localStorage.settings;
			
			if (savedSettings !== undefined) {
				savedSettings = JSON.parse(savedSettings);
				var dailySummaryOptionValues = savedSettings.dailySummaryOptions;
				for (var i = 0, length = dailySummaryOptionElements.length; i < length; i++) {
					dailySummaryOptionElements[i].checked = dailySummaryOptionValues[dailySummaryOptionElements[i].name];
				}
			}
			
			function saveOptions() {
        		var settings = {
          			"dailySummaryOptions": {}
        		};
        		
        		for (var i = 0, length = dailySummaryOptionElements.length; i < length; i++) {
        			settings.dailySummaryOptions[dailySummaryOptionElements[i].name] = dailySummaryOptionElements[i].checked;
        		}
        		
        		settings = JSON.stringify(settings);
        		console.log(settings);
        		localStorage.settings = settings;
        		return settings;
      		}
      		
      		var resetButton = document.getElementById("reset_button");
      		resetButton.addEventListener("click",
      			function () {
      				localStorage.removeItem("settings");
      			},
      			false
      		);
      		
      		var submitButton = document.getElementById("save_button");
      		submitButton.addEventListener("click", 
        		function () {
        			console.log("Pebble close");
          			document.location = "pebblejs://close#" + encodeURIComponent(saveOptions());
        		},
        		false
      		);
		</script>
	</body>
</html>